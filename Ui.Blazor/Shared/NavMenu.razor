@implements IDisposable

@inject UiText T

<nav class="app-nav" aria-label="Primary">
  <NavLink class="app-nav-link" href="/home">
    <span class="app-nav-icon" aria-hidden="true">ğŸ </span>
    <span class="app-nav-label fw-semibold">@T["Nav.Home"]</span>
  </NavLink>

  @if (AppState.IsAuthenticated && AppState.IsOnboarded)
  {
    <NavLink class="app-nav-link" href="/study">
      <span class="app-nav-icon" aria-hidden="true">ğŸ“š</span>
      <span class="app-nav-label fw-semibold">@T["Nav.Study"]</span>
    </NavLink>
    <NavLink class="app-nav-link" href="/settings">
      <span class="app-nav-icon" aria-hidden="true">âš™ï¸</span>
      <span class="app-nav-label fw-semibold">@T["Nav.Settings"]</span>
    </NavLink>
    <NavLink class="app-nav-link" href="/logout">
      <span class="app-nav-icon" aria-hidden="true">ğŸšª</span>
      <span class="app-nav-label fw-semibold">@T["Nav.Logout"]</span>
    </NavLink>
  }
  else if (AppState.IsAuthenticated)
  {
    <NavLink class="app-nav-link" href="/logout">
      <span class="app-nav-icon" aria-hidden="true">ğŸšª</span>
      <span class="app-nav-label fw-semibold">@T["Nav.Logout"]</span>
    </NavLink>
  }
  else
  {
    <NavLink class="app-nav-link" href="/login">
      <span class="app-nav-icon" aria-hidden="true">ğŸ”</span>
      <span class="app-nav-label fw-semibold">@T["Nav.Login"]</span>
    </NavLink>
    <NavLink class="app-nav-link" href="/register">
      <span class="app-nav-icon" aria-hidden="true">ğŸ“</span>
      <span class="app-nav-label fw-semibold">@T["Nav.Register"]</span>
    </NavLink>
  }
</nav>

@code {
  protected override void OnInitialized()
  {
    // Re-render NavMenu whenever auth/onboarding state changes.
    AppState.OnChange += OnAppStateChanged;
    UserSettings.OnChange += OnAppStateChanged;
  }

  private void OnAppStateChanged()
  {
    // Must re-render UI on state changes.
    _ = InvokeAsync(StateHasChanged);
  }

  public void Dispose()
  {
    AppState.OnChange -= OnAppStateChanged;
    UserSettings.OnChange -= OnAppStateChanged;
  }
}
